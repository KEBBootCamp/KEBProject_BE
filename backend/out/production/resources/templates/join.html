<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Join Form</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $("#isExpert").change(function() {
                if ($(this).is(":checked")) {
                    $("#expertFields").show();
                } else {
                    $("#expertFields").hide();
                }
            });
        });

        function submitForm() {
            const isExpert = $("#isExpert").is(":checked");
            const user = {
                userId: $("#userId").val(),
                userPwd: $("#userPwd").val(),
                userName: $("#userName").val(),
                userNickname: $("#userNickname").val(),
                userEmail: $("#userEmail").val(),
                userPhonenumber: $("#userPhonenumber").val(),
                isExpert: isExpert
            };

            if (isExpert) {
                const expert = {
                    userId: $("#userId").val(),
                    userPwd: $("#userPwd").val(),
                    userName: $("#userName").val(),
                    userNickname: $("#userNickname").val(),
                    userEmail: $("#userEmail").val(),
                    userPhonenumber: $("#userPhonenumber").val(),
                    isExpert: isExpert,
                    engineerCareer: $("#engineerCareer").val(),
                    engineerPicture: $("#engineerPicture").val(),
                    engineerCertification: $("#engineerCertification").val(),
                    engineerProfile: $("#engineerProfile").val(),
                    ratingAverage: parseFloat($("#ratingAverage").val())
                };

                $.ajax({
                    type: "POST",
                    url: "/users/expertjoin",
                    data: JSON.stringify(expert),
                    contentType: "application/json",
                    success: function(response) {
                        $("#response").text(response);
                    },
                    error: function(error) {
                        $("#response").text("Error: " + error.responseText);
                    }
                });
            } else {
                $.ajax({
                    type: "POST",
                    url: "/users/join",
                    data: JSON.stringify(user),
                    contentType: "application/json",
                    success: function(response) {
                        $("#response").text(response);
                    },
                    error: function(error) {
                        $("#response").text("Error: " + error.responseText);
                    }
                });
            }
        }
    </script>
</head>
<body>
<h1>Join Form</h1>
<form onsubmit="event.preventDefault(); submitForm();">
    <div>
        <label for="userId">User ID:</label>
        <input type="text" id="userId" required />
    </div>
    <div>
        <label for="userPwd">Password:</label>
        <input type="password" id="userPwd" required />
    </div>
    <div>
        <label for="userName">Name:</label>
        <input type="text" id="userName" required />
    </div>
    <div>
        <label for="userNickname">Nickname:</label>
        <input type="text" id="userNickname" required />
    </div>
    <div>
        <label for="userEmail">Email:</label>
        <input type="email" id="userEmail" required />
    </div>
    <div>
        <label for="userPhonenumber">Phone Number:</label>
        <input type="text" id="userPhonenumber" required />
    </div>
    <div>
        <label for="isExpert">Is Expert:</label>
        <input type="checkbox" id="isExpert" />
    </div>

    <div id="expertFields" style="display: none;">
        <h2>Expert Details</h2>
        <div>
            <label for="engineerCareer">Engineer Career:</label>
            <input type="number" id="engineerCareer" />
        </div>
        <div>
            <label for="engineerPicture">Engineer Picture:</label>
            <input type="text" id="engineerPicture" />
        </div>
        <div>
            <label for="engineerCertification">Engineer Certification:</label>
            <input type="text" id="engineerCertification" />
        </div>
        <div>
            <label for="engineerProfile">Engineer Profile:</label>
            <textarea id="engineerProfile"></textarea>
        </div>
        <div>
            <label for="ratingAverage">Rating Average:</label>
            <input type="number" step="0.1" id="ratingAverage" />
        </div>
    </div>

    <div>
        <button type="submit">Join</button>
    </div>
</form>

<div id="response"></div>
</body>
</html>